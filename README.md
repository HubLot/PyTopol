# PyTopol

Reza Salari - [Brannigan Lab](http://branniganlab.org)

### Introduction 

**PyTopol** provides utilities to convert certain molecular topologies to 
each other. Currently it supports converting NAMD `psf` files to GROMACS 
topology format. If you'd like to use GROMACS topologies in NAMD, plese 
see [here](http://www.ks.uiuc.edu/Research/namd/2.9/ug/node14.html).

PyTopol follows a different approach than the force-field conversion tools. 
It is intended to convert the full-topology of a molecule from one format to
another. 


### Current stage
PyTopol is currently in *alpha stage*. The results for several 
systems are shown below which are encouraging. However, before using it for
production run simulations, more testing is required. 


### Feedback
If you have a question, found a bug or have a suggestion, please submit it
[here](http://github.com/resal81/pytopol/issues). 

### License
PyTopol is licensed under [GNU GPLv3](http://www.gnu.org/licenses/gpl.html). 



## Quickstart

#### Method 1 - using `pip` (python package installer)

    $ pip install pytopol 
    $ psf2top.py -p psffile -c charmm_prm1 [charmm_prm2 ...] [-v]

#### Method 2 - clone the git repo 

    $ git clone http://github.com/resal81/pytopol
    $ cd pytopol 
    $ export PYTHONPATH=`pwd`:$PYTHONPATH
    $ cd scripts 
    $ python psf2top.py -p psffile -c charmm_prm1 [charmm_prm2 ...] [-v]


## Example run
For a protein+lipid `psf` system, the GROMACS topology can be generated by the
  follwing command. This assumes that name of the `psf` file is `system.psf` and
  you have the necessary parameter files in the same directory.

    $ psf2top.py -p system.psf -c par_all36_prot.prm par_all36_lipid.prm

You can also use `-v` for debug information.


## Notes 

* `psf2top.py` converts the `psf` file to GROMACS topology format. It creates one
 `top.top` plus one or multiple `itp` files. Each segment in the `psf` file is converted 
 to one `itp` file. 

* `psf2top.py` only accepts NAMD formatted `psf` files, where the columns in the
  atoms section of the `psf` file are separated by at least one space. If this
  is the case for your `psf` file, make sure there is a `NAMD` keyword in the
  first line of the `psf` file.

* You should provide all CHARMM parameter files for all the atoms in your `psf`
  file. This typically corresponds to the parameter files that you use for your system
  when running the NAMD simulation. 

* The CHARMM stream files (with `str` suffix) are not supported. These are files that typically
  include both topology and parameters for a molecule. For these cases put the
  parameter section in a separate file before giving it to `psf2top.py`.

* For the CHARMM parameter files, the `NBFIX` and `HBOND` sections are
 currently ignored.


## Would you like to help?
There are many ways you can help to improve **PyTopol**:

* Convert your `psf` files to GROMACS format and compare NAMD and GROMACS energies.
  Use the issues page to let me know of the potential discrepancies.

* Run simulations using the generated topologies and see if the results make sense.

* Fork this repo, implement improvements and send me a pull request.

## Test systems 

I used `psf2top.py` to convert several non-trivial `psf` files to GROMACS format 
  and then compared the resulting single-point energies using NAMD 2.9 and 
  GROMACS 4.5.7. I used the following configuration files:

*GROMACS MDP file*
```
integrator    = md
nsteps        = 0
nstlog        = 1
nstlist       = 0
ns_type       = simple
rlist         = 0
coulombtype   = cut-off
rcoulomb      = 0
rvdw          = 0
pbc           = no
```

*NAMD configuration file*
```
structure          [psffile]
coordinates        [pdbfile]

paratypecharmm      on
parameters         [parameter files]
exclude             scaled1-4
1-4scaling          1.0

switching           off
cutoff              1000
pairlistdist        1000
timestep            1.0
outputenergies      1
outputtiming        1
binaryoutput        no

outputname          namd
dcdfreq             1
temperature         300
run                 0
```

GROMACS simulation was run using:

    $ grompp -f mdpfile -c pdbfile -p top.top -o topol.tpr
    $ mdrun -nt 1 -s topol.tpr -rerun pdbfile -g gromacs.log

NAMD simulation was run using:

    $ namd2 +p1 conf

#### Results (energies are in kcal/mol)

1_memb - POCP membrane in vacuum using CHARMM 27 (38 POPC, 5092 atoms)

    1_memb       NAMD         GROMACS     Diff (%) 
          bond       1539.1       1539.1       0.000
         angle       3111.9       3111.9      -0.001
      dihedral       1250.5       1250.5      -0.000
      improper         16.3         16.3       0.000
          coul      -1705.3      -1705.3      -0.000
           vdw      -1219.3      -1219.3       0.000

2_lys - 1LYZ in vacuum using CHARMM 27 and CMAP (PDB ID: 1LYZ, 1966 atoms)

    2_lys        NAMD         GROMACS     Diff (%) 
          bond      11807.4      11807.3      -0.000
         angle       5946.3       5946.3      -0.000
      dihedral        781.8        781.9       0.013
      improper        578.2        578.2       0.000
          coul      -3221.8      -3109.3      -3.491
           vdw    1741437.8    1744647.9       0.184

3_chol - Cholestrol in TIP3P water using CHARMM 36 (3810 atoms)

    3_chol       NAMD         GROMACS     Diff (%) 
          bond       1169.4       1176.7       0.624
         angle        320.7        320.7       0.000
      dihedral         22.9         22.9       0.000
      improper          0.0          0.0          NA
          coul     -11887.9     -11873.5      -0.121
           vdw       1071.9       1083.0       1.037

4_memb - POPC/DOPC membrane made with [CHARMM-GUI](http://www.charmm-gui.org/?doc=input/membrane) (19 POPC, 19 DOPC, N atoms)

## TODO 
* 

## Acknowledgement 
* Energy conversion factors are from `charmm2gromacs-pvm.py` script by Par Bjelkmar, 
Per Larsson, Michel Cuendet, Berk Hess and Erik Lindahl

## Similar tools
* [charmm2gromacs](http://www.gromacs.org/@api/deki/files/185/=charmm2gromacs-pvm.py) 
  is a tool for converting CHARMM force field to GROMACS.
* [SwissParam](http://www.swissparam.ch/) converts `mol2` format to CHARMM and GROMACS
  formats.



